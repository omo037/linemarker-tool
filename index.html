<!DOCTYPE html> 
<html lang="ja">
<head>
<meta charset="UTF-8">

<title>Advanced Marker Generator</title>

<style>

:root {
  --marker-color: #fff176;
  --marker-border-color: #ff9800;
  --marker-border-width: 2px;
  --text-color: #000000;
  --marker-height: 16px;
  --marker-expand: 6px;
  --marker-radius: 10px;
  --font-size: 28px;
  --marker-offset: 0px;
}

body {
  margin: 0;
  padding: 40px;
  font-family: "Segoe UI", sans-serif;
  background: #fafafa;
}

.container {
  width: 320px;
  display: flex;
  flex-direction: column;
  gap: 18px;
}

.setting {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.setting label {
  font-size: 14px;
  margin-right: 20px;
}

textarea {
  width: 100%;
  height: 80px;
  padding: 10px;
  font-size: 16px;
  border-radius: 12px;
  border: 1px solid #ddd;
  box-sizing: border-box;
  font-family: inherit;
}

input[type="text"] {
  width: 80px;
  padding: 6px 8px;
  border-radius: 10px;
  border: 1px solid #ddd;
  font-family: inherit;
}

input[type="number"] {
  width: 70px;
  padding: 6px 8px;
  border-radius: 10px;
  border: 1px solid #ddd;
  font-family: inherit;
}

select {
  width: 110px;
  padding: 6px 8px;
  border-radius: 10px;
  border: 1px solid #ddd;
  font-family: inherit;
}

input[type="color"] {
  -webkit-appearance: none;
  appearance: none;
  width: 20px;
  height: 20px;
  box-sizing: border-box;
  padding: 0;
  border-radius: 10px;
  border: 1px solid #ddd;
  cursor: pointer;
  background: none;
}

input[type="color"]::-webkit-color-swatch-wrapper {
  padding: 0;
}

input[type="color"]::-webkit-color-swatch {
  border: none;
  border-radius: 8px;
}

input[type="color"]::-moz-color-swatch {
  border: none;
  border-radius: 8px;
}

.divider {
  height: 1px;
  background: #e5e5e5;
  margin: 8px 0;
}

.preview {
  margin-top: 20px;
  margin-left: auto;
  margin-right: auto;
  position: relative;
  display: inline-block;
  font-size: var(--font-size);
  padding: 0 12px;
  line-height: 1.4;
  white-space: nowrap;
  width: fit-content;
  max-width: none;
  text-align: center;
  color: var(--text-color);
  font-family: inherit;
}

.preview::after {
  content: "";
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, calc(-50% + var(--marker-offset)));
  width: calc(100% + var(--marker-expand) * 2);
  height: var(--marker-height);
  background: var(--marker-color);
  border-radius: var(--marker-radius);
  border: var(--marker-border-width) solid var(--marker-border-color);
  z-index: -1;
}

.preview:empty::after {
  display: none;
}

.url-container {
  margin-top: 12px;
  display: flex;
  align-items: center;
  border: 1px solid #e0e0e0;
  border-radius: 12px;
  overflow: hidden;
  background: #ffffff;
}

.url-container input {
  flex: 1;
  border: none;
  padding: 10px;
  font-size: 12px;
  outline: none;
  background: transparent;
}

.url-container button {
  width: 42px;
  height: 42px;
  border: none;
  background: #000;
  color: #fff;
  cursor: pointer;
  font-size: 16px;
}

</style>
</head>

<body>

<div class="container" id="mainContainer">
  
<h2>Marker Tool</h2>
  
<textarea id="inputText" placeholder="ã“ã“ã«æ–‡å­—ã‚’å…¥åŠ›"></textarea>

<div class="setting">
  <label>Text color</label>
  <div>
    <input type="color" id="textColorPicker" value="#000000">
    <input type="text" id="textColorCode" value="#000000">
  </div>
</div>

<div class="setting">
  <label>Text size</label>
  <input type="number" id="fontSize" value="28">
</div>

<div class="setting">
  <label>Text weight</label>
  <select id="fontWeight">
    <option value="400">Regular</option>
    <option value="500">Medium</option>
    <option value="600">SemiBold</option>
    <option value="700">Bold</option>
    <option value="800">ExtraBold</option>
  </select>
</div>

<div class="divider"></div>

<div class="setting">
  <label>Marker Color</label>
  <div>
    <input type="color" id="markerColorPicker" value="#fff176">
    <input type="text" id="markerColorCode" value="#fff176">
  </div>
</div>

<div class="setting">
  <label>Marker Height</label>
  <input type="number" id="markerHeight" value="16">
</div>

<div class="setting">
  <label>Marker Width</label>
  <input type="number" id="markerExpand" value="6">
</div>

<div class="setting">
  <label>Marker Radius</label>
  <input type="number" id="markerRadius" value="10">
</div>

<div class="setting">
  <label>Marker Position</label>
  <input type="number" id="markerOffset" value="0">
</div>

<div class="setting">
  <label>Edge Color</label>
  <div>
    <input type="color" id="markerBorderPicker" value="#ff9800">
    <input type="text" id="markerBorderCode" value="#ff9800">
  </div>
</div>

<div class="setting">
  <label>Edge Height</label>
  <input type="number" id="markerBorderWidth" value="2">
</div>

<div id="preview" class="preview"></div>

<div class="url-container" id="urlContainer">
  <input type="text" id="generatedUrl" readonly>
  <button onclick="copyUrl()">ðŸ“‹</button>
</div>

</div>

<script>

function generate() {
  preview.textContent = inputText.value;
  preview.style.fontWeight = fontWeight.value;

  document.documentElement.style.setProperty('--font-size', fontSize.value + "px");
  document.documentElement.style.setProperty('--marker-color', markerColorCode.value);
  document.documentElement.style.setProperty('--marker-border-color', markerBorderCode.value);
  document.documentElement.style.setProperty('--marker-border-width', markerBorderWidth.value + "px");
  document.documentElement.style.setProperty('--text-color', textColorCode.value);
  document.documentElement.style.setProperty('--marker-height', markerHeight.value + "px");
  document.documentElement.style.setProperty('--marker-expand', markerExpand.value + "px");
  document.documentElement.style.setProperty('--marker-radius', markerRadius.value + "px");
  document.documentElement.style.setProperty('--marker-offset', markerOffset.value + "px");

  updateUrl();
}

function updateUrl() {
  const params = new URLSearchParams({
    text: inputText.value,
    size: fontSize.value,
    weight: fontWeight.value,
    textColor: textColorCode.value,
    markerColor: markerColorCode.value,
    markerHeight: markerHeight.value,
    markerExpand: markerExpand.value,
    markerRadius: markerRadius.value,
    markerOffset: markerOffset.value,
    borderColor: markerBorderCode.value,
    borderWidth: markerBorderWidth.value
  });

  const url = location.origin + location.pathname + "?" + params.toString();
  history.replaceState(null, "", url);
  document.getElementById("generatedUrl").value = url;
}

function copyUrl() {
  navigator.clipboard.writeText(
    document.getElementById("generatedUrl").value
  );
}

function loadFromUrl() {
  const params = new URLSearchParams(window.location.search);
  if (!params.toString()) return;

  inputText.value = params.get("text") || "";
  fontSize.value = params.get("size") || 28;
  fontWeight.value = params.get("weight") || 400;
  textColorCode.value = params.get("textColor") || "#000000";
  markerColorCode.value = params.get("markerColor") || "#fff176";
  markerHeight.value = params.get("markerHeight") || 16;
  markerExpand.value = params.get("markerExpand") || 6;
  markerRadius.value = params.get("markerRadius") || 10;
  markerOffset.value = params.get("markerOffset") || 0;
  markerBorderCode.value = params.get("borderColor") || "#ff9800";
  markerBorderWidth.value = params.get("borderWidth") || 2;

  generate();
}

/* ===== ã“ã“ãŒä»Šå›žã®è¿½åŠ éƒ¨åˆ† ===== */
function applyMode() {
  const params = new URLSearchParams(window.location.search);
  if (params.get("mode") === "embed") {
    document.getElementById("mainContainer").style.display = "none";
    document.body.style.padding = "40px";
    document.body.style.display = "flex";
    document.body.style.justifyContent = "center";
    document.body.appendChild(preview);
  }
}

document.querySelectorAll("input, select, textarea").forEach(el=>{
  el.addEventListener("input", generate);
});

[
 ["markerColorPicker","markerColorCode"],
 ["markerBorderPicker","markerBorderCode"],
 ["textColorPicker","textColorCode"]
].forEach(([p,c])=>{
  document.getElementById(p).addEventListener("input",()=>{
    document.getElementById(c).value=document.getElementById(p).value;
  });
  document.getElementById(c).addEventListener("input",()=>{
    document.getElementById(p).value=document.getElementById(c).value;
  });
});

generate();
loadFromUrl();
applyMode();

</script>

</body>
</html>
